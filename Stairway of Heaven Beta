loadstring(game:HttpGet("https://raw.githubusercontent.com/till16604-hue/Hub-Stuff/refs/heads/main/Raw%20GUI"))()

do
	local Players = game:GetService("Players")
	local TweenService = game:GetService("TweenService")
	local TextService = game:GetService("TextService")
	local RunService = game:GetService("RunService")

	local player = Players.LocalPlayer
	local pg = player:WaitForChild("PlayerGui")

	local function findDescendant(root, name)
		for _, d in ipairs(root:GetDescendants()) do
			if d.Name == name then return d end
		end
		return nil
	end

	local function waitHub(timeout)
		local t0 = tick()
		while tick() - t0 < (timeout or 8) do
			local hub = pg:FindFirstChild("N0BD.HUB")
			if hub and hub:IsA("ScreenGui") then
				return hub
			end
			RunService.RenderStepped:Wait()
		end
		return nil
	end

	local toastFrame, toastHideTask

	local function tween(obj, t, props)
		local tw = TweenService:Create(obj, TweenInfo.new(t, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), props)
		tw:Play()
		return tw
	end

	local function corner(parent, px)
		local c = Instance.new("UICorner")
		c.CornerRadius = UDim.new(0, px)
		c.Parent = parent
		return c
	end

	local function stroke(parent, color, transparency, thickness)
		local s = Instance.new("UIStroke")
		s.Color = color
		s.Thickness = thickness or 1
		s.Transparency = transparency or 0.8
		s.Parent = parent
		return s
	end

	local function readTheme(hub)
		-- defaults (match your UI)
		local Theme = {
			Card   = Color3.fromRGB(12, 26, 58),
			Stroke = Color3.fromRGB(40, 110, 255),
			Text   = Color3.fromRGB(225, 238, 255),
			Accent = Color3.fromRGB(0, 230, 255),
		}

		local main = hub:FindFirstChild("Main") or findDescendant(hub, "Main")
		if not main then return Theme end

		local topbar = main:FindFirstChild("Topbar") or findDescendant(main, "Topbar")
		local glowLine = topbar and topbar:FindFirstChild("GlowLine")
		local titleLbl = topbar and topbar:FindFirstChild("Title")

		if glowLine and glowLine:IsA("Frame") then
			Theme.Accent = glowLine.BackgroundColor3
		end
		if titleLbl and titleLbl:IsA("TextLabel") then
			Theme.Text = titleLbl.TextColor3
		end

		local anyStroke = main:FindFirstChildOfClass("UIStroke") or findDescendant(main, "UIStroke")
		if anyStroke and anyStroke:IsA("UIStroke") then
			Theme.Stroke = anyStroke.Color
		end

		return Theme
	end

	local function ShowToast(hub, msg, duration)
		msg = tostring(msg or "")
		duration = tonumber(duration) or 1.6

		-- cancel old
		if toastHideTask then
			task.cancel(toastHideTask)
			toastHideTask = nil
		end
		if toastFrame then
			toastFrame:Destroy()
			toastFrame = nil
		end

		-- ensure on top
		pcall(function()
			hub.DisplayOrder = 999999
			hub.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		end)

		local Theme = readTheme(hub)

		-- auto width + wrap if needed
		local font = Enum.Font.GothamSemibold
		local textSize = 13
		local padL, padR = 12, 12

		local minW, maxW = 220, 420
		local textW = TextService:GetTextSize(msg, textSize, font, Vector2.new(9999, 44)).X
		local w = math.clamp(math.floor(textW + padL + padR + 14), minW, maxW)

		local wrapped = (w >= maxW - 1)
		local h = wrapped and 56 or 44

		toastFrame = Instance.new("Frame")
		toastFrame.Name = "__N0BD_TOAST"
		toastFrame.BackgroundColor3 = Theme.Card
		toastFrame.BorderSizePixel = 0
		toastFrame.AnchorPoint = Vector2.new(1, 1)
		toastFrame.Position = UDim2.new(1, -18, 1, 20) -- start offscreen
		toastFrame.Size = UDim2.fromOffset(w, h)
		toastFrame.ZIndex = 999999
		toastFrame.Parent = hub
		corner(toastFrame, 16)
		stroke(toastFrame, Theme.Accent, 0.75, 2)
		stroke(toastFrame, Theme.Stroke, 0.90, 1)

		local pad = Instance.new("UIPadding")
		pad.PaddingLeft = UDim.new(0, padL)
		pad.PaddingRight = UDim.new(0, padR)
		pad.Parent = toastFrame

		local t = Instance.new("TextLabel")
		t.BackgroundTransparency = 1
		t.Size = UDim2.new(1, 0, 1, 0)
		t.Font = font
		t.TextSize = textSize
		t.TextColor3 = Theme.Text
		t.TextXAlignment = Enum.TextXAlignment.Left
		t.TextYAlignment = Enum.TextYAlignment.Center
		t.TextWrapped = wrapped
		t.Text = msg
		t.ZIndex = toastFrame.ZIndex + 1
		t.Parent = toastFrame

		-- slide in
		toastFrame.BackgroundTransparency = 1
		tween(toastFrame, 0.18, {
			Position = UDim2.new(1, -18, 1, -18),
			BackgroundTransparency = 0
		})

		toastHideTask = task.delay(duration, function()
			if toastFrame then
				tween(toastFrame, 0.18, {
					Position = UDim2.new(1, -18, 1, 20),
					BackgroundTransparency = 1
				})
				task.delay(0.20, function()
					if toastFrame then
						toastFrame:Destroy()
						toastFrame = nil
					end
				end)
			end
		end)
	end

	getgenv().N0BD_Toast = function(msg, duration)
		local hub = waitHub(8)
		if not hub then return false end
		ShowToast(hub, msg, duration)
		return true
	end
end

-- =========================================================
-- PlaceId check (NOW uses Toast)
-- =========================================================
local ALLOWED_PLACEID = 8737899170

if game.PlaceId ~= ALLOWED_PLACEID then
	local msg = ("Wrong PlaceId! Allowed: %d | Current: %d"):format(ALLOWED_PLACEID, game.PlaceId)

	local ok = false
	pcall(function()
		ok = (getgenv().N0BD_Toast and getgenv().N0BD_Toast(msg, 3.2)) or false
	end)

	-- fallback (only if toast not available)
	if not ok then
		pcall(function()
			game:GetService("StarterGui"):SetCore("SendNotification", {
				Title = "N0BD.HUB",
				Text = msg,
				Duration = 8,
			})
		end)
	end

	return
end


local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local pg = player:WaitForChild("PlayerGui")

-- ===== SETTINGS =====
local TAB_NAME  = "StairwayOfHeaven"
local ROW_LABEL = "Enable / Disable"
local ENV_FLAG  = "StairwayOfHeaven_Enabled" -- stored state in getgenv()

-- =========================
-- Maid / Janitor (robust)
-- =========================
local function NewMaid()
	local self = { _tasks = {} }

	function self:Give(taskObj)
		if taskObj == nil then return nil end
		table.insert(self._tasks, taskObj)
		return taskObj
	end

	function self:Cleanup()
		for i = #self._tasks, 1, -1 do
			local t = self._tasks[i]
			self._tasks[i] = nil

			if type(t) == "function" then
				pcall(t)
				continue
			end

			if typeof(t) == "RBXScriptConnection" then
				pcall(function() t:Disconnect() end)
				continue
			end

			if typeof(t) == "Instance" then
				pcall(function() t:Destroy() end)
				continue
			end

			if typeof(t) == "thread" then
				pcall(function() task.cancel(t) end)
				continue
			end
		end
	end

	return self
end

-- ===== UI helper functions =====
local function addCorner(obj, px)
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(0, px)
	c.Parent = obj
	return c
end

local function addStroke(obj, color, transparency, thickness)
	local s = Instance.new("UIStroke")
	s.Color = color
	s.Transparency = transparency or 0.9
	s.Thickness = thickness or 1
	s.Parent = obj
	return s
end

local function findDescendant(root, name)
	for _, d in ipairs(root:GetDescendants()) do
		if d.Name == name then
			return d
		end
	end
	return nil
end

-- ===== WAIT FOR UI ROOT =====
local hub
do
	local t0 = tick()
	repeat
		hub = pg:FindFirstChild("N0BD.HUB")
		if not hub then task.wait(0.1) end
	until hub or (tick() - t0) > 8
end
if not hub then warn("N0BD.HUB not found in PlayerGui") return end

local main = hub:FindFirstChild("Main") or findDescendant(hub, "Main") or hub
local sidebar = findDescendant(main, "Sidebar")
local content = findDescendant(main, "Content")
if not sidebar or not content then
	warn("Sidebar/Content not found (UI structure differs)")
	return
end

-- ===== Theme colors (best effort) =====
local topbar = findDescendant(main, "Topbar")
local glowLine = topbar and topbar:FindFirstChild("GlowLine")
local titleLbl = topbar and topbar:FindFirstChild("Title")

local accent = (glowLine and glowLine.BackgroundColor3) or Color3.fromRGB(0,230,255)
local textColor = (titleLbl and titleLbl.TextColor3) or Color3.fromRGB(225,238,255)
local subText = Color3.fromRGB(150,175,210)

local cardColor = Color3.fromRGB(12, 26, 58)
local darkCard = Color3.fromRGB(16, 26, 54)
local activeCard = Color3.fromRGB(18, 44, 92)
local strokeBlue = Color3.fromRGB(40, 110, 255)

-- ===== Pages parent detection =====
local pagesParent = content:FindFirstChild("Pages")
if pagesParent and not (pagesParent:IsA("Folder") or pagesParent:IsA("Frame")) then
	pagesParent = nil
end
pagesParent = pagesParent or content

local mainPage = pagesParent:FindFirstChild("Main")
if not (mainPage and mainPage:IsA("GuiObject")) then
	mainPage = findDescendant(content, "Main")
end

local function isPage(obj)
	return obj:IsA("Frame") or obj:IsA("ScrollingFrame")
end

local function getPages()
	local pages = {}
	for _, ch in ipairs(pagesParent:GetChildren()) do
		if ch:IsA("GuiObject") and isPage(ch) then
			table.insert(pages, ch)
		end
	end
	return pages
end

local function showPage(target)
	for _, p in ipairs(getPages()) do
		if p and p:IsA("GuiObject") then
			p.Visible = (p == target)
		end
	end
end


-- Find existing Main tab button (optional)
local mainTabBtn
for _, ch in ipairs(sidebar:GetChildren()) do
	if ch:IsA("TextButton") and ch.Text:lower():find("main") then
		mainTabBtn = ch
		break
	end
end

local function setTabActive(btn, active)
	if not btn then return end
	btn.BackgroundColor3 = active and activeCard or cardColor
	btn.TextColor3 = active and accent or textColor
end

-- Sidebar scrolling fix (if sidebar is ScrollingFrame)
local function autoCanvas(scrolling)
	if not scrolling:IsA("ScrollingFrame") then return end
	local layout = scrolling:FindFirstChildOfClass("UIListLayout")
	if not layout then return end
	local function update()
		scrolling.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
	end
	layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(update)
	task.defer(update)
end
autoCanvas(sidebar)

-- =========================================================
-- Create Page
-- =========================================================
local page = Instance.new("Frame")
page.Name = "StairwayOfHeavenPage"
page.BackgroundTransparency = 1
page.Size = UDim2.new(1, 0, 1, 0)
page.Visible = false
page.Parent = pagesParent

local header = Instance.new("TextLabel")
header.BackgroundTransparency = 1
header.Size = UDim2.new(1, 0, 0, 44)
header.Font = Enum.Font.GothamBold
header.TextSize = 16
header.TextColor3 = textColor
header.TextXAlignment = Enum.TextXAlignment.Left
header.Text = TAB_NAME
header.Parent = page

-- =========================================================
-- Enable / Disable Row
-- =========================================================
local row = Instance.new("TextButton")
row.Name = "EnableDisableRow"
row.AutoButtonColor = false
row.BackgroundColor3 = cardColor
row.BorderSizePixel = 0
row.Position = UDim2.fromOffset(0, 44)
row.Size = UDim2.new(1, 0, 0, 74)
row.Text = ""
row.Parent = page
addCorner(row, 18)
addStroke(row, strokeBlue, 0.90, 1)

local pad = Instance.new("UIPadding")
pad.PaddingLeft = UDim.new(0, 14)
pad.PaddingRight = UDim.new(0, 14)
pad.PaddingTop = UDim.new(0, 12)
pad.PaddingBottom = UDim.new(0, 12)
pad.Parent = row

local label = Instance.new("TextLabel")
label.BackgroundTransparency = 1
label.Size = UDim2.new(1, -140, 0, 18)
label.Font = Enum.Font.GothamSemibold
label.TextSize = 14
label.TextColor3 = textColor
label.TextXAlignment = Enum.TextXAlignment.Left
label.Text = ROW_LABEL
label.Parent = row

local status = Instance.new("TextLabel")
status.BackgroundTransparency = 1
status.Position = UDim2.fromOffset(0, 22)
status.Size = UDim2.new(1, -140, 0, 18)
status.Font = Enum.Font.Gotham
status.TextSize = 12
status.TextColor3 = subText
status.TextXAlignment = Enum.TextXAlignment.Left
status.Text = "Status: DISABLED"
status.Parent = row

local stateBtn = Instance.new("TextButton")
stateBtn.AutoButtonColor = false
stateBtn.BackgroundColor3 = darkCard
stateBtn.BorderSizePixel = 0
stateBtn.AnchorPoint = Vector2.new(1, 0.5)
stateBtn.Position = UDim2.new(1, 0, 0.5, 0)
stateBtn.Size = UDim2.fromOffset(120, 38)
stateBtn.Font = Enum.Font.GothamBold
stateBtn.TextSize = 12
stateBtn.TextColor3 = textColor
stateBtn.Text = "DISABLED"
stateBtn.Parent = row
addCorner(stateBtn, 16)
local sbStroke = addStroke(stateBtn, strokeBlue, 0.90, 1)

-- =========================================================
-- Controller (FIXED: re-enable works)
-- =========================================================
getgenv()[ENV_FLAG] = (getgenv()[ENV_FLAG] == true)

local currentMaid = nil
local enabled = false
local clickDebounce = false

-- Cancel token system (key fix)
local Ctrl = getgenv().StairwayOfHeaven_CTRL or { cancel = 0, running = false }
getgenv().StairwayOfHeaven_CTRL = Ctrl

local function applyVisuals()
	local isOn = (enabled == true)
	row.BackgroundColor3 = isOn and Color3.fromRGB(14, 34, 78) or cardColor
	status.Text = isOn and "Status: ENABLED" or "Status: DISABLED"
	stateBtn.Text = isOn and "ENABLED" or "DISABLED"
	stateBtn.BackgroundColor3 = isOn and activeCard or darkCard
	stateBtn.TextColor3 = isOn and accent or textColor
	sbStroke.Transparency = isOn and 0.75 or 0.90
end

local function Disable()
	-- invalidate running threads/loops
	Ctrl.cancel += 1
	Ctrl.running = false

	-- reset flags so re-enable is possible
	_G.s = false
	pcall(function() getgenv().Stairway = false end)

	enabled = false
	getgenv()[ENV_FLAG] = false

	if currentMaid then
		currentMaid:Cleanup()
		currentMaid = nil
	end

	applyVisuals()
end

local function Enable()
	-- only start once per cycle
	if Ctrl.running then
		enabled = true
		applyVisuals()
		return
	end

	-- start new cycle
	Disable()

	currentMaid = NewMaid()
	Ctrl.running = true
	Ctrl.cancel += 1
	local myCancel = Ctrl.cancel

	enabled = true
	getgenv()[ENV_FLAG] = true
	applyVisuals()

	-- ensure cleanup resets everything
	currentMaid:Give(function()
		Ctrl.running = false
		_G.s = false
		pcall(function() getgenv().Stairway = false end)
	end)

	-- =========================
	-- YOUR STAIRWAY LOGIC (non-blocking)
	-- =========================
	pcall(function() getgenv().Stairway = true end)

	getgenv().N0BD_Toast("Made by Mikey, this is only a beta",10)
	print("Made by Mikey, this is only a beta")

	local function alive()
		return Ctrl.running and myCancel == Ctrl.cancel and enabled
	end

	-- Heartbeat coord tracker (example)
	local coordinates = 0
	local hbConn = RunService.Heartbeat:Connect(function()
		if not alive() then return end
		local lp = Players.LocalPlayer
		local ch = lp.Character
		local hrp = ch and ch:FindFirstChild("HumanoidRootPart")
		if hrp then
			coordinates = hrp.Position.Y
		end
	end)
	currentMaid:Give(hbConn)

	-- Run the rest in a thread so Enable() can finish (this was your main bug)
	local th = task.spawn(function()
		local lp = Players.LocalPlayer
		local ch = lp.Character or lp.CharacterAdded:Wait()
		local hrp = ch:WaitForChild("HumanoidRootPart", 10)
		if not hrp then return end

		if not alive() then return end
		hrp.CFrame = CFrame.new(120.79306030273438, -126.99183654785156, -213.44664001464844)

		for _ = 1, 50 do
			if not alive() then return end
			task.wait(0.1)
		end

		if not alive() then return end
		ch = lp.Character or lp.CharacterAdded:Wait()
		hrp = ch:WaitForChild("HumanoidRootPart", 10)
		if not hrp then return end
		hrp.CFrame = CFrame.new(630.6519165039062, 143.7024383544922, -1891.4598388671875)

		for _ = 1, 10 do
			if not alive() then return end
			task.wait(0.1)
		end

		_G.s = true

		while alive() and _G.s do
			local ch2 = lp.Character
			local hrp2 = ch2 and ch2:FindFirstChild("HumanoidRootPart")
			if hrp2 then
				local p = hrp2.Position
				hrp2.CFrame = CFrame.new(p.X, p.Y + 36, p.Z)
			end
			task.wait(0.2)
		end
	end)
	currentMaid:Give(th)
end

local function Toggle()
	if clickDebounce then return end
	clickDebounce = true
	task.delay(0.12, function() clickDebounce = false end)

	if enabled then
		Disable()
	else
		Enable()
	end
end

row.MouseButton1Click:Connect(Toggle)
stateBtn.MouseButton1Click:Connect(Toggle)

-- Init
enabled = (getgenv()[ENV_FLAG] == true)
applyVisuals()

if enabled then
	task.defer(function()
		Enable()
	end)
end

-- =========================================================
-- Sidebar Tab Button
-- =========================================================
local tabBtn = Instance.new("TextButton")
tabBtn.AutoButtonColor = false
tabBtn.BackgroundColor3 = cardColor
tabBtn.BorderSizePixel = 0
tabBtn.Size = UDim2.new(1, 0, 0, 42)
tabBtn.Font = Enum.Font.GothamSemibold
tabBtn.TextSize = 13
tabBtn.TextXAlignment = Enum.TextXAlignment.Left
tabBtn.TextColor3 = textColor
tabBtn.Text = "   " .. TAB_NAME
tabBtn.Parent = sidebar
addCorner(tabBtn, 16)
addStroke(tabBtn, strokeBlue, 0.92, 1)
tabBtn.LayoutOrder = 9999

tabBtn.MouseButton1Click:Connect(function()
	showPage(page)
	setTabActive(tabBtn, true)
	setTabActive(mainTabBtn, false)
end)

if mainTabBtn then
	mainTabBtn.MouseButton1Click:Connect(function()
		if mainPage and mainPage:IsA("GuiObject") then
			showPage(mainPage)
		else
			local pages = getPages()
			if pages[1] then showPage(pages[1]) end
		end
		setTabActive(mainTabBtn, true)
		setTabActive(tabBtn, false)
	end)
end


if mainTabBtn then setTabActive(mainTabBtn, true) end
setTabActive(tabBtn, false)
